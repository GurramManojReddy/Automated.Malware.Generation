//-----6-----

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <windows.h>
#include <tchar.h>
void AutoRun();
void AutoRun()
{
    TCHAR szPath[MAX_PATH];
    GetModuleFileName(NULL, szPath, MAX_PATH);
    TCHAR szProcessName[MAX_PATH];
    TCHAR *pszProcessName;
    pszProcessName = strrchr(szPath, '\\');
    pszProcessName++;
    strcpy(szProcessName, pszProcessName);
    TCHAR szDirectory[MAX_PATH];
    strcpy(szDirectory, szPath);
    pszProcessName = strrchr(szDirectory, '\\');
    *pszProcessName = '\0';
    TCHAR szRegKey[MAX_PATH];
    strcpy(szRegKey, "Software\\Microsoft\\Windows\\CurrentVersion\\Run");
    HKEY hKey;
    LONG lResult = RegOpenKeyEx(HKEY_CURRENT_USER, szRegKey, 0, KEY_SET_VALUE, &hKey);
    if (lResult != ERROR_SUCCESS)
    {
        printf("Error: Can not open the registry key.\n");
        return;
    }
    lResult = RegSetValueEx(hKey, szProcessName, 0, REG_SZ, (LPBYTE)szPath, _tcslen(szPath) * sizeof(TCHAR));
    if (lResult != ERROR_SUCCESS)
    {
        printf("Error: Can not add the value to the registry key.\n");
        return;
    }
    RegCloseKey(hKey);
}