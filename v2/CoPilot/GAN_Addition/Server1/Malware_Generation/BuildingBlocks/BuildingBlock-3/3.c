//-----3-----

#include <windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
void AutoRun()
{
    char ModuleName[256];
    char KeyName[256];
    char *p = NULL;
    if (GetModuleFileName(NULL, ModuleName, sizeof(ModuleName)) == 0)
    {
        printf("GetModuleFileName() failed with error code %d\n", GetLastError());
        return;
    }
    if ((p = strrchr(ModuleName, '\\')) == NULL)
    {
        printf("strrchr() failed with error code %d\n", GetLastError());
        return;
    }
    *p = '\0';
    sprintf(KeyName, "Software\\Microsoft\\Windows\\CurrentVersion\\Run");
    HKEY hKey = NULL;
    if (RegOpenKeyEx(HKEY_CURRENT_USER, KeyName, 0, KEY_ALL_ACCESS, &hKey) != ERROR_SUCCESS)
    {
        printf("RegOpenKeyEx() failed with error code %d\n", GetLastError());
        return;
    }
    if (RegSetValueEx(hKey, "MyApp", 0, REG_SZ, (BYTE *)ModuleName, strlen(ModuleName)) != ERROR_SUCCESS)
    {
        printf("RegSetValueEx() failed with error code %d\n", GetLastError());
        return;
    }
    RegCloseKey(hKey);
}