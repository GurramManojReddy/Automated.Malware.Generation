//-----3-----

#include <windows.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
int Decode_Base64(void *encoded, int size, void *decoded);
int Decode_Base64(void *encoded, int size, void *decoded)
{
    int i = 0, j = 0;
    char *p = (char *)encoded;
    char *q = (char *)decoded;
    char *base64char = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
    char *base64index = (char *)malloc(256);
    int *base64int = (int *)base64index;
    int index = 0;
    int *pint = (int *)p;
    int *qint = (int *)q;
    int *end = (int *)(p + size);
    int decodedSize = 0;
    memset(base64index, 0, 256);
    for (i = 0; i < strlen(base64char); i++)
    {
        index = base64char[i];
        base64index[index] = i;
    }
    while (pint < end)
    {
        index = *pint;
        for (i = 0; i < 4; i++)
        {
            index = (index << 6) | base64index[*++p];
        }
        for (i = 0; i < 3; i++)
        {
            *qint = (index >> (8 * (2 - i))) & 0xFF;
            if (*qint != '=')
            {
                qint++;
                decodedSize++;
            }
        }
        pint++;
    }
    return decodedSize;
}