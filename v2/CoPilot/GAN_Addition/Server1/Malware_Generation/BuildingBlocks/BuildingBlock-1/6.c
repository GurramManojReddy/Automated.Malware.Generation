#include <windows.h>
#include <stdio.h>

BOOL Debugger_Identification()
{
	BOOL bResult = FALSE;
	DWORD dwLastError = 0;
	BOOL bIsDebuggerPresent = FALSE;
	BOOL bIsDebuggerPresentResult = FALSE;
	BOOL bCheckRemoteDebuggerPresentResult = FALSE;
	BOOL bIsDebuggerPresentExResult = FALSE;
	HANDLE hCurrentProcess = NULL;
	BOOL bIsRemoteDebuggerPresent = FALSE;
	BOOL bIsRemoteDebuggerPresentResult = FALSE;
	BOOL bIsDebuggerPresentExDebuggerPresent = FALSE;
	bIsDebuggerPresent = IsDebuggerPresent();
	if (bIsDebuggerPresent == TRUE)
	{
		bResult = TRUE;
		goto lblCleanup;
	}
	bIsDebuggerPresentResult = CheckRemoteDebuggerPresent(GetCurrentProcess(), &bIsRemoteDebuggerPresent);
	if (bIsDebuggerPresentResult == TRUE && bIsRemoteDebuggerPresent == TRUE)
	{
		bResult = TRUE;
		goto lblCleanup;
	}
	bIsDebuggerPresentExResult = IsDebuggerPresent();
	if (bIsDebuggerPresentExResult == TRUE)
	{
		bResult = TRUE;
		goto lblCleanup;
	}
	bIsDebuggerPresentExDebuggerPresent = IsDebuggerPresent();
	if (bIsDebuggerPresentExDebuggerPresent == TRUE)
	{
		bResult = TRUE;
		goto lblCleanup;
	}
	bResult = FALSE;
lblCleanup:
	return bResult;
}