import time
import sys
import requests
import re

def main():
    # Get the input variation from the command line arguments
    if len(sys.argv) > 1:
        input_var = sys.argv[1]
        print(f"Received input variation: {input_var}")
    else:
        print("No input variation provided.")
        return  # Exit the script if no input variation is provided

    # Specify the URL of the server with the input argument
    print("Request Started")
    url = f'http://localhost:8001/{input_var}'  # Modify the URL with the input argument

    # Send a GET request to the server
    response = requests.get(f'{url}')

    # Check if the download request was successful (status code 200)
    if response.status_code == 200:
    # Extract the filename from the Content-Disposition header
        content_disposition = response.headers.get('Content-Disposition')
        print(content_disposition)
        if content_disposition:
            match = re.search(r'filename=(.+)', content_disposition)
            print(match)
            if match:
                filename = match.group(1)
            else:
                filename = 'downloaded_file.zip'
        else:
            filename = 'downloaded_file.zip'

        # Save the downloaded zip file in the current working directory
        print(filename)
        with open(filename, 'wb') as downloaded_file:
            downloaded_file.write(response.content)

        print(f"Downloaded zip file successfully. Saved as: {filename}")
    else:
        print(f"Failed to download zip file. Server returned status code: {response.status_code}")

if __name__ == "__main__":
    main()
