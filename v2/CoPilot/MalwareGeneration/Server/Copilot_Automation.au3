#include <Array.au3>

; File from which the data is to be read
$fileContents = FileRead('C:\Users\Win10\Desktop\Project\Controls\Input.txt')

If @error Then
    MsgBox(16, "Error", "Failed to read the file.")
    Exit
EndIf
; Split the file contents into lines
$lines = StringSplit($fileContents, @CRLF)
$pointData = "" ; Initialize a variable to store the current point's data
Local $points[1]

For $i = 1 To $lines[0]
    ; Check if the current line is not empty
    If $lines[$i] <> "" Then
        ; Check if the line starts with a number followed by a dot and space
        If StringRegExp($lines[$i], "^\d+\.\s") Then
			Local $extractedData = StringRegExpReplace($lines[$i], "^\d+\.\s", "")
			$lines[$i] = $extractedData
            ; If a new point is found, process the previous point's data
            If $pointData <> "" Then
                ; Perform actions using $pointData
                _ArrayAdd($points, $pointData)
                $pointData = ""
            EndIf
        EndIf

        ; Append the current line to $pointData
        $pointData &= $lines[$i]

        ; Add a line break if it's not the last line
        If $i < $lines[0] Then
            $pointData &= @CRLF
        EndIf
    EndIf
Next

; Add the last point to $points if it's not empty
If $pointData <> "" Then
    $points &= $pointData
EndIf
If $pointData <> "" Then
    _ArrayAdd($points, $pointData)
EndIf

; Running the copilot automation
For $j=1 To UBound($points) - 1
	If ProcessExists("Code.exe") Then
		; VS Code is running
		WinActivate("Welcome - Visual Studio Code")
	Else
		; VS Code is not running, so starting the vscode
		Run ("C:\Program Files\Microsoft VS Code\Code.exe")
		WinWaitActive("Welcome - Visual Studio Code")
	EndIf
	sleep(2000)
	; Creating a new file
	Send("^!#n")
	sleep(2000)
	; Opening the file
	Send("BuildingBlock.c")
	sleep(2000)
	Send("{ENTER}")
	sleep(2000)
	WinWaitActive("Create File")
	sleep(2000)
	; Writing the code
	Send('C:\Users\Win10\Desktop\Project\Controls\BuildingBlock.c')
	sleep(2000)
	Send("{ENTER}")
	Sleep(2000)
	Local $pointLines = StringSplit($points[$j], @CRLF)
	For $k = 1 To $pointLines[0]
		If $pointLines[$k] <> "" Then
			sleep(500)
			send($pointLines[$k])
			Send("{ENTER}")
		EndIf
	Next
	Send("{ENTER}")
	Send("{ENTER}")
	Sleep(3000)
	; Asking for suggestions
	Send("^{ENTER}")
	Sleep(10000)
	; Copying the suggestions
	Send("^a")
	Sleep(1000)
	Send("^c")
	Sleep(1000)
	Send("^{F4}")
	Sleep(1000)
	; Copying the suggestions to a file
	$clipboardText = ClipGet()

	If StringLen($clipboardText) > 0 Then
	    $filePath = 'C:\Users\Win10\Desktop\Project\Controls\Suggestions.txt'
	    $fileHandle = FileOpen($filePath, 1)
	    If $fileHandle = -1 Then
	    Else
		FileWrite($fileHandle, $clipboardText)
		FileClose($fileHandle)
	    EndIf
	Else
	EndIf
	Send("^s")
	Sleep(5000)
	Send("^{F4}")
	
Next