//-----3-----

#include <windows.h>
#include <stdio.h>
void Run_From_Memory(void *shellcode, int size);
void Run_From_Memory(void *shellcode, int size)
{
    DWORD oldProtection;
    void *ptr = VirtualAlloc(0, size, MEM_COMMIT, PAGE_READWRITE);
    if (ptr == NULL)
    {
        printf("VirtualAlloc() failed\n");
        return;
    }
    memcpy(ptr, shellcode, size);
    printf("Allocated memory at: 0x%p\n", ptr);
    if (VirtualProtect(ptr, size, PAGE_EXECUTE_READ, &oldProtection) == 0)
    {
        printf("VirtualProtect() failed\n");
        return;
    }
    printf("Executing shellcode...\n\n");
    (*(void(*)()) ptr)();
}