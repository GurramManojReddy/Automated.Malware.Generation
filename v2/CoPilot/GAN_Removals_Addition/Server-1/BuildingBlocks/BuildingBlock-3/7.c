//-----5-----

#include <windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <tchar.h>
#define WIN32_LEAN_AND_MEAN
void AutoRun();
void AutoRun()
{
	TCHAR szPath[MAX_PATH];
	GetModuleFileName(NULL, szPath, MAX_PATH);
	HKEY hKey = NULL;
	if (RegOpenKeyEx(HKEY_CURRENT_USER, _T("Software\\Microsoft\\Windows\\CurrentVersion\\Run"), 0, KEY_ALL_ACCESS, &hKey) != ERROR_SUCCESS)
	{
		printf("Error: Cannot open the registry!\n");
		return;
	}
	if (RegSetValueEx(hKey, _T("AutoRun"), 0, REG_SZ, (LPBYTE)szPath, (lstrlen(szPath) + 1) * sizeof(TCHAR)) != ERROR_SUCCESS)
	{
		printf("Error: Cannot add the current path to the registry!\n");
		RegCloseKey(hKey);
		return;
	}
	RegCloseKey(hKey);
	printf("Success: Added to the registry!\n");
}