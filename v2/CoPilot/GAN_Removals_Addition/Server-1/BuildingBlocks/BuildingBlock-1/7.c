#include <windows.h>
#include <stdio.h>
#include <tchar.h>

#pragma comment(lib, "User32.lib")
#define BUFSIZE 4096
BOOL Debugger_Identification()
{
    TCHAR Buffer[BUFSIZE];
    DWORD dwRet;
    dwRet = GetEnvironmentVariable(TEXT("__COMPAT_LAYER"), Buffer, BUFSIZE);
    if (dwRet > 0 && dwRet < BUFSIZE)
    {
        _tprintf(TEXT("The __COMPAT_LAYER variable is %s\n"), Buffer);
        return TRUE;
    }
    else if (dwRet == 0)
    {
        _tprintf(TEXT("The __COMPAT_LAYER variable is not defined.\n"));
        return FALSE;
    }
    else
    {
        _tprintf(TEXT("GetEnvironmentVariable failed (%d)\n"), GetLastError());
        return FALSE;
    }
}
