//-----4-----

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <windows.h>
int Decode_Base64(void *encoded, int size, void *decoded);
int Decode_Base64(void *encoded, int size, void *decoded)
{
    int i, j, k;
    int num;
    int decoded_size;
    char *base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    decoded_size = 0;
    for (i = 0; i < size; i += 4)
    {
        num = 0;
        for (j = 0; j < 4; j++)
        {
            if (((char *)encoded)[i + j] == '=')
            {
                num += 0;
            }
            else
            {
                for (k = 0; k < 64; k++)
                {
                    if (((char *)encoded)[i + j] == base64[k])
                    {
                        num += k;
                    }
                }
            }
            if (j < 3)
            {
                num <<= 6;
            }
        }
        for (j = 2; j >= 0; j--)
        {
            if (((char *)encoded)[i + j + 1] != '=')
            {
                ((char *)decoded)[decoded_size + j] = num & 0xFF;
                num >>= 8;
            }
        }
        decoded_size += 3;
    }
    ((char *)decoded)[decoded_size] = '\0';
    return decoded_size;
}